// service.proto
// gRPC API definitions for LYRA microservices

syntax = "proto3";

package lyra;

option go_package = "internal/pb";

service WhisperService {
    // Transcribe audio/video file by file key (MinIO)
    rpc Transcribe(TranscribeRequest) returns (TranscribeResponse);

    // Health check endpoint
    rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);

    // Create asynchronous transcription task
    rpc CreateTranscriptionTask(CreateTranscriptionTaskRequest) returns (CreateTaskResponse);
    
    // Get status/result of asynchronous task
    rpc GetTaskStatus(GetTaskStatusRequest) returns (GetTaskStatusResponse);
}

// Request for transcription
message TranscribeRequest {
    // Unique task identifier (UUID, generated by client)
    string task_id = 1;
    // Key of the audio or video file in MinIO (object storage)
    string file_key = 2;
}

// Request for async task creation
message CreateTranscriptionTaskRequest {
    string task_id = 1;
    string file_key = 2;
}

message TranscribeResponse {
    // Transcribed text
    string text = 1;
    // Error message (optional)
    string error = 2;
}

message HealthCheckRequest {}
message HealthCheckResponse {
    string status = 1;
}

// Response for async task creation
message CreateTaskResponse {
    string task_id = 1;
    string error = 2;
}

// Request for task status
message GetTaskStatusRequest {
    string task_id = 1;
}

// Response for task status
message GetTaskStatusResponse {
    string status = 1;
    string result = 2;
    string error = 3;
    int64 created_at = 4;
    int64 updated_at = 5;
}
